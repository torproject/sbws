<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1241px" preserveAspectRatio="none" style="width:517px;height:1241px;" version="1.1" viewBox="0 0 517 1241" width="517px" zoomAndPan="magnify"><defs><filter height="300%" id="fz6rz3k2gra6i" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="490" x="12.5" y="26.708">"Activity diagram Torflow measurements aggregation."</text><rect fill="#FFFFFF" filter="url(#fz6rz3k2gra6i)" height="480.0781" style="stroke: #000000; stroke-width: 2.0;" width="496" x="10" y="31.7549"/><path d="M362,32.7549 L362,41.0518 L352,51.0518 L10,51.0518 " fill="none" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="342" x="13" y="45.75">Initialize relays from consensus (prev_consensus)</text><rect fill="#FEFECE" filter="url(#fz6rz3k2gra6i)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="221" x="147.5" y="61.0518"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="201" x="157.5" y="82.1904">ns_list = c.get_network_status()</text><rect fill="#FEFECE" filter="url(#fz6rz3k2gra6i)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="476" x="20" y="115.0205"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="456" x="30" y="136.1592">ns_list.sort(lambda x, y: int(y.bandwidth/10000.0 - x.bandwidth/10000.0))</text><rect fill="#FEFECE" filter="url(#fz6rz3k2gra6i)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="155" x="180.5" y="168.9893"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="135" x="190.5" y="190.1279">prev_consensus = {}</text><rect fill="#FEFECE" filter="url(#fz6rz3k2gra6i)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="98" x="209" y="266.958"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="78" x="219" y="288.0967">n = ns_list[i]</text><rect fill="#FEFECE" filter="url(#fz6rz3k2gra6i)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="105" x="205.5" y="320.9268"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="85" x="215.5" y="342.0654">n.list_rank = i</text><rect fill="#FEFECE" filter="url(#fz6rz3k2gra6i)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="146" x="185" y="389.8955"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="126" x="195" y="411.0342">n.measured = False</text><rect fill="#FEFECE" filter="url(#fz6rz3k2gra6i)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="230" x="143" y="443.8643"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="210" x="153" y="465.0029">prev_consensus["$"+n.idhex] = n</text><polygon fill="#FEFECE" filter="url(#fz6rz3k2gra6i)" points="175.5,222.958,340.5,222.958,352.5,234.958,340.5,246.958,175.5,246.958,163.5,234.958,175.5,222.958" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="165" x="175.5" y="238.7661">for i in range(0, len(ns_list))?</text><rect fill="#FFFFFF" filter="url(#fz6rz3k2gra6i)" height="402.5742" style="stroke: #000000; stroke-width: 2.0;" width="287" x="119" y="522.6348"/><path d="M396,523.6348 L396,531.9316 L386,541.9316 L119,541.9316 " fill="none" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="267" x="122" y="536.6299">Aggregate raw measurements (nodes)</text><rect fill="#FEFECE" filter="url(#fz6rz3k2gra6i)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="93" x="211.5" y="558.9316"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="73" x="221.5" y="580.0703">nodes = {}</text><rect fill="#FEFECE" filter="url(#fz6rz3k2gra6i)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="89" x="213.5" y="705.3027"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="69" x="223.5" y="726.4414">n = Node()</text><rect fill="#FEFECE" filter="url(#fz6rz3k2gra6i)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="154" x="181" y="759.2715"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="134" x="191" y="780.4102">nodes[line.idhex] = n</text><rect fill="#FEFECE" filter="url(#fz6rz3k2gra6i)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="116" x="200" y="813.2402"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="96" x="210" y="834.3789">n.add_line(line)</text><polygon fill="#FEFECE" filter="url(#fz6rz3k2gra6i)" points="190.5,656.9004,325.5,656.9004,337.5,668.9004,325.5,680.9004,190.5,680.9004,178.5,668.9004,190.5,656.9004" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="20" x="262" y="691.1108">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="135" x="190.5" y="672.7085">line.idhex not in nodes?</text><polygon fill="#FEFECE" filter="url(#fz6rz3k2gra6i)" points="258,867.209,270,879.209,258,891.209,246,879.209,258,867.209" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#FEFECE" filter="url(#fz6rz3k2gra6i)" points="206.5,612.9004,309.5,612.9004,321.5,624.9004,309.5,636.9004,206.5,636.9004,194.5,624.9004,206.5,612.9004" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="103" x="206.5" y="628.7085">for line in bw_file?</text><rect fill="#FFFFFF" filter="url(#fz6rz3k2gra6i)" height="240.668" style="stroke: #000000; stroke-width: 2.0;" width="429" x="48" y="936.0107"/><path d="M221,937.0107 L221,945.3076 L211,955.3076 L48,955.3076 " fill="none" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="163" x="51" y="950.0059">Assign consensus flags</text><rect fill="#FEFECE" filter="url(#fz6rz3k2gra6i)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="332" x="92" y="1064.71"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="312" x="102" y="1085.8486">nodes[idhex].flags = prev_consensus[idhex].flags</text><polygon fill="#FEFECE" filter="url(#fz6rz3k2gra6i)" points="184.5,1016.3076,331.5,1016.3076,343.5,1028.3076,331.5,1040.3076,184.5,1040.3076,172.5,1028.3076,184.5,1016.3076" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="20" x="262" y="1050.5181">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="147" x="184.5" y="1032.1157">idhex in prev_consensus?</text><polygon fill="#FEFECE" filter="url(#fz6rz3k2gra6i)" points="258,1118.6787,270,1130.6787,258,1142.6787,246,1130.6787,258,1118.6787" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#FEFECE" filter="url(#fz6rz3k2gra6i)" points="175,972.3076,341,972.3076,353,984.3076,341,996.3076,175,996.3076,163,984.3076,175,972.3076" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="166" x="175" y="988.1157">for idhex in nodes.iterkeys()?</text><rect fill="#FEFECE" filter="url(#fz6rz3k2gra6i)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="64" x="226" y="1196.6787"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="44" x="236" y="1217.8174">scaling</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="258" x2="258" y1="95.0205" y2="115.0205"/><polygon fill="#A80036" points="254,105.0205,258,115.0205,262,105.0205,258,109.0205" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="258" x2="258" y1="148.9893" y2="168.9893"/><polygon fill="#A80036" points="254,158.9893,258,168.9893,262,158.9893,258,162.9893" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="258" x2="258" y1="300.9268" y2="320.9268"/><polygon fill="#A80036" points="254,310.9268,258,320.9268,262,310.9268,258,314.9268" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="258" x2="258" y1="354.8955" y2="389.8955"/><polygon fill="#A80036" points="254,379.8955,258,389.8955,262,379.8955,258,383.8955" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="258" x2="258" y1="423.8643" y2="443.8643"/><polygon fill="#A80036" points="254,433.8643,258,443.8643,262,433.8643,258,437.8643" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="258" x2="258" y1="246.958" y2="266.958"/><polygon fill="#A80036" points="254,256.958,258,266.958,262,256.958,258,260.958" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="258" x2="258" y1="477.833" y2="487.833"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="258" x2="385" y1="487.833" y2="487.833"/><polygon fill="#A80036" points="381,370.3955,385,360.3955,389,370.3955,385,366.3955" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="385" x2="385" y1="234.958" y2="487.833"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="385" x2="352.5" y1="234.958" y2="234.958"/><polygon fill="#A80036" points="362.5,230.958,352.5,234.958,362.5,238.958,358.5,234.958" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="163.5" x2="131" y1="234.958" y2="234.958"/><polygon fill="#A80036" points="127,356.3955,131,366.3955,135,356.3955,131,360.3955" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="131" x2="131" y1="234.958" y2="499.833"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="131" x2="258" y1="499.833" y2="499.833"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="258" x2="258" y1="499.833" y2="558.9316"/><polygon fill="#A80036" points="254,548.9316,258,558.9316,262,548.9316,258,552.9316" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="258" x2="258" y1="202.958" y2="222.958"/><polygon fill="#A80036" points="254,212.958,258,222.958,262,212.958,258,216.958" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="258" x2="258" y1="739.2715" y2="759.2715"/><polygon fill="#A80036" points="254,749.2715,258,759.2715,262,749.2715,258,753.2715" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="258" x2="258" y1="793.2402" y2="813.2402"/><polygon fill="#A80036" points="254,803.2402,258,813.2402,262,803.2402,258,807.2402" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="258" x2="258" y1="680.9004" y2="705.3027"/><polygon fill="#A80036" points="254,695.3027,258,705.3027,262,695.3027,258,699.3027" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="337.5" x2="349.5" y1="668.9004" y2="668.9004"/><polygon fill="#A80036" points="345.5,766.2559,349.5,776.2559,353.5,766.2559,349.5,770.2559" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="349.5" x2="349.5" y1="668.9004" y2="879.209"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="349.5" x2="270" y1="879.209" y2="879.209"/><polygon fill="#A80036" points="280,875.209,270,879.209,280,883.209,276,879.209" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="258" x2="258" y1="847.209" y2="867.209"/><polygon fill="#A80036" points="254,857.209,258,867.209,262,857.209,258,861.209" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="258" x2="258" y1="636.9004" y2="656.9004"/><polygon fill="#A80036" points="254,646.9004,258,656.9004,262,646.9004,258,650.9004" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="258" x2="258" y1="891.209" y2="901.209"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="258" x2="369" y1="901.209" y2="901.209"/><polygon fill="#A80036" points="365,774.2559,369,764.2559,373,774.2559,369,770.2559" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="369" x2="369" y1="624.9004" y2="901.209"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="369" x2="321.5" y1="624.9004" y2="624.9004"/><polygon fill="#A80036" points="331.5,620.9004,321.5,624.9004,331.5,628.9004,327.5,624.9004" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="194.5" x2="159" y1="624.9004" y2="624.9004"/><polygon fill="#A80036" points="155,760.2559,159,770.2559,163,760.2559,159,764.2559" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="159" x2="159" y1="624.9004" y2="913.209"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="159" x2="258" y1="913.209" y2="913.209"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="258" x2="258" y1="913.209" y2="972.3076"/><polygon fill="#A80036" points="254,962.3076,258,972.3076,262,962.3076,258,966.3076" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="258" x2="258" y1="592.9004" y2="612.9004"/><polygon fill="#A80036" points="254,602.9004,258,612.9004,262,602.9004,258,606.9004" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="258" x2="258" y1="1040.3076" y2="1064.71"/><polygon fill="#A80036" points="254,1054.71,258,1064.71,262,1054.71,258,1058.71" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="343.5" x2="434" y1="1028.3076" y2="1028.3076"/><polygon fill="#A80036" points="430,1071.6943,434,1081.6943,438,1071.6943,434,1075.6943" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="434" x2="434" y1="1028.3076" y2="1130.6787"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="434" x2="270" y1="1130.6787" y2="1130.6787"/><polygon fill="#A80036" points="280,1126.6787,270,1130.6787,280,1134.6787,276,1130.6787" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="258" x2="258" y1="1098.6787" y2="1118.6787"/><polygon fill="#A80036" points="254,1108.6787,258,1118.6787,262,1108.6787,258,1112.6787" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="258" x2="258" y1="996.3076" y2="1016.3076"/><polygon fill="#A80036" points="254,1006.3076,258,1016.3076,262,1006.3076,258,1010.3076" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="258" x2="258" y1="1142.6787" y2="1152.6787"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="258" x2="458" y1="1152.6787" y2="1152.6787"/><polygon fill="#A80036" points="454,1079.6943,458,1069.6943,462,1079.6943,458,1075.6943" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="458" x2="458" y1="984.3076" y2="1152.6787"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="458" x2="353" y1="984.3076" y2="984.3076"/><polygon fill="#A80036" points="363,980.3076,353,984.3076,363,988.3076,359,984.3076" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="163" x2="70" y1="984.3076" y2="984.3076"/><polygon fill="#A80036" points="66,1065.6943,70,1075.6943,74,1065.6943,70,1069.6943" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="70" x2="70" y1="984.3076" y2="1164.6787"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="70" x2="258" y1="1164.6787" y2="1164.6787"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="258" x2="258" y1="1164.6787" y2="1196.6787"/><polygon fill="#A80036" points="254,1186.6787,258,1196.6787,262,1186.6787,258,1190.6787" style="stroke: #A80036; stroke-width: 1.0;"/><!--
@startuml
title "Activity diagram Torflow measurements aggregation."


partition "Initialize relays from consensus (prev_consensus)" {
    :ns_list = c.get_network_status();
    :ns_list.sort(lambda x, y: int(y.bandwidth/10000.0 - x.bandwidth/10000.0));

    :prev_consensus = {};
    while (for i in range(0, len(ns_list))?)
        :n = ns_list[i];
        :n.list_rank = i;
        :n.measured = False;
        :prev_consensus["$"+n.idhex] = n;
    endwhile
}

partition "Aggregate raw measurements (nodes)"
    :nodes = {};
    while (for line in bw_file?)
        if (line.idhex not in nodes?) then (yes)
            :n = Node();
            :nodes[line.idhex] = n;
            :n.add_line(line);
        endif
    endwhile
}

partition "Assign consensus flags"
    while (for idhex in nodes.iterkeys()?)
        if (idhex in prev_consensus?) then (yes)
            :nodes[idhex].flags = prev_consensus[idhex].flags;
        endif
    endwhile
}

:scaling;

@enduml

PlantUML version 1.2018.13(Mon Nov 26 17:11:51 GMT 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.9.1+1-post-Debian-1deb10u2
Operating System: Linux
OS Version: 4.19.0-13-amd64
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>